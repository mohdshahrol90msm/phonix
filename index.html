<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Sketchfab AR - Phoenix Bird</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
      background: transparent;
    }

    #camera {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      object-fit: cover;
      z-index: 0;
    }

    #viewer-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      touch-action: none;
      overflow: hidden;
      z-index: 1;
    }

    #iframe-wrapper {
      width: 100%;
      height: 100%;
      transform-origin: center center;
      will-change: transform;
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
      background: transparent;
    }
  </style>
</head>
<body>
  <!-- Camera Background -->
  <video id="camera" autoplay muted playsinline></video>

  <!-- Sketchfab Viewer -->
  <div id="viewer-container">
    <div id="iframe-wrapper">
      <iframe
        title="phoenix bird"
        allowfullscreen
        mozallowfullscreen="true"
        webkitallowfullscreen="true"
        allow="autoplay; fullscreen; xr-spatial-tracking"
        xr-spatial-tracking
        execution-while-out-of-viewport
        execution-while-not-rendered
        web-share
        src="https://sketchfab.com/models/844ba0cf144a413ea92c779f18912042/embed?autostart=1&transparent=1">
      </iframe>
    </div>
  </div>

  <!-- Touch Gestures with Hammer.js -->
  <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8/hammer.min.js"></script>
  <script>
    // Camera stream
    const video = document.getElementById('camera');
    navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" }, audio: false })
      .then(stream => {
        video.srcObject = stream;
      })
      .catch(err => {
        console.error("Camera access denied:", err);
      });

    // Pinch/Zoom/Pan logic
    const wrapper = document.getElementById('iframe-wrapper');
    let scale = 1;
    let lastScale = 1;
    let posX = 0;
    let posY = 0;
    let lastPosX = 0;
    let lastPosY = 0;

    const hammer = new Hammer.Manager(wrapper);
    hammer.add(new Hammer.Pan({ threshold: 0, pointers: 0 }));
    hammer.add(new Hammer.Pinch({ threshold: 0 })).recognizeWith(hammer.get('pan'));

    hammer.on("panmove", (ev) => {
      posX = lastPosX + ev.deltaX;
      posY = lastPosY + ev.deltaY;
      updateTransform();
    });

    hammer.on("panend", () => {
      lastPosX = posX;
      lastPosY = posY;
    });

    hammer.on("pinchmove", (ev) => {
      scale = Math.max(0.5, Math.min(3, lastScale * ev.scale));
      updateTransform();
    });

    hammer.on("pinchend", () => {
      lastScale = scale;
    });

    function updateTransform() {
      wrapper.style.transform = `translate(${posX}px, ${posY}px) scale(${scale})`;
    }
  </script>
</body>
</html>
